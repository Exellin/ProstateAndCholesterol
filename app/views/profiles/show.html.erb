<% if @profile.empty? && (@profile.user == current_user) %>
  <%= link_to "Create your profile", edit_profile_path(@profile), class: 'btn btn-lg btn-info' %>
<% else %>
  <h2><%= @profile.user.username %></h2>
  <h3>Profile</h3> 
  <% if !current_user.nil? && current_user == @profile.user %> 
    <div class="row">
      <div class="col-xs-3">
        <%= link_to "edit profile", edit_profile_path(@profile), class: "btn btn-xs btn-primary" %>
      </div>
    </div>
  <% end %>
  
  <div class="row">
    <div class="col-xs-3">
      <h4>Story</h4>
    </div>
    <div class="col-xs-8">
      <%= @profile.story %>
    </div>
  </div>

  <% if !current_user.nil? && (current_user == @profile.user || current_user.admin?) %>
    <div class="row">
      <div class="col-xs-3">
        <h4>Name</h4>
      </div>
      <div class="col-xs-8">
      <%= "#{@profile.first_name} #{@profile.last_name}" %>
      </div>
    </div>
    
    <div class="row">
      <div class="col-xs-3">
        <h4>Birth Year</h4>
      </div>
      <div class="col-xs-8">
        <%= @profile.birth_year %>
      </div>
    </div>
    
    <div class="row">
      <div class="col-xs-3">
        <h4>Location</h4>
      </div>
      <div class="col-xs-8">
        <%= "#{@profile.city}, #{@profile.administrative_division}, #{@profile.country_name}" %>
      </div>
    </div>
    
    <div class="row">
      <div class="col-xs-3">
        <h4>Years Within 200miles/320km of current location</h4>
      </div>
      <div class="col-xs-8">
        <%= @profile.years_in_current_locale %>
      </div>
    </div>
    
    <div class="row">
      <div class="col-xs-3">
        <h4>Race</h4>
      </div>
      <div class="col-xs-8">
        <%= @profile.race %>
      </div>
    </div>
    
    <div class="row">
      <div class="col-xs-3">
        <h4>Ancestral Descent</h4>
      </div>
      <div class="col-xs-8">
        <%= @profile.ancestral_descent %>
      </div>
    </div>
    
    <div class="row">
      <div class="col-xs-3">
        <h4>Age Noticed Symptoms</h4>
      </div>
      <div class="col-xs-8">
        <%= @profile.age_noticed_symptoms %>
      </div>
    </div>
    
    <div class="row">
      <div class="col-xs-3">
        <h4>Age Urinary Malfunction</h4>
      </div>
      <div class="col-xs-8">
        <%= @profile.age_urinary_malfunction %>
      </div>
    </div>
    
    <div class="row">
      <div class="col-xs-3">
        <h4>Age Bladder Infection</h4>
      </div>
      <div class="col-xs-8">
        <%= @profile.age_bladder_infection %>
      </div>
    </div>
  <% end %>
  
  <h3>PSA History</h3>
  <% if !current_user.nil? && current_user == @profile.user %> 
    <div class="row">
      <div class="col-xs-3">
        <%= link_to "edit psa history",
        "#{edit_profile_path(@profile)}#psa_history", class: "btn btn-xs btn-primary" %>
      </div>
    </div>
  <% end %>
  
  <%= content_tag "div", id: "psa_chart", data: {psa: @psa_histories} do %>
  <% end %>
  
  <h3>Cholesterol History</h3>
  <% if !current_user.nil? && current_user == @profile.user %>
    <div class="row">
      <div class="col-xs-3">
        <%= link_to "edit cholesterol history", 
        "#{edit_profile_path(@profile)}#cholesterol_history", class: "btn btn-xs btn-primary" %>
      </div>
    </div>
  <% end %>
  
  <table>
    <tr>
      <th>Total Cholesterol</th>
      <th>HDL</th>
      <th>LDL</th>
      <th>Triglyceride</th>
      <th>Glucose</th>
      <th>Month</th>
      <th>Year</th>
    </tr>
    <% @profile.cholesterol_histories.each do |cholesterol_history| %>
      <tr>
        <td><%= cholesterol_history.total_cholesterol %></td>
        <td><%= cholesterol_history.hdl %></td>
        <td><%= cholesterol_history.ldl %></td>
        <td><%= cholesterol_history.triglyceride %></td>
        <td><%= cholesterol_history.glucose %></td>
        <td><%= cholesterol_history.month %></td>
        <td><%= cholesterol_history.year %></td>
      </tr>
    <% end %>
  </table>
  
  <h3>Medications</h3>
  <% if !current_user.nil? && current_user == @profile.user %>
    <div class="row">
      <div class="col-xs-3">
        <%= link_to "edit medications",
        "#{edit_profile_path(@profile)}#medication", class: "btn btn-xs btn-primary" %>
      </div>
    </div>
  <% end %>
  
  <table>
    <tr>
      <th>Purpose</th>
      <th>Name</th>
      <th>Age Recommended</th>
      <th>Age Prescribed</th>
      <th>Strength</th>
      <th>Dosage</th>
      <th>Month Last Used</th>
      <th>Year Last Used</th>
      <th>Still Using</th>
    </tr>
    <% @profile.medications.each do |medication| %>
    <tr>
      <td><%= medication.purpose %></td>
      <td><%= medication.name %></td>
      <td><%= medication.age_recommended%></td>
      <td><%= medication.age_prescribed %></td>
      <td><%= medication.strength %></td>
      <td><%= medication.dosage %></td>
      <td><%= medication.month_last_used %></td>
      <td><%= medication.year_last_used %></td>
      <td><%= medication.still_using? ? "Yes" : "No" %></td>
    </tr>
    <% end %>
  </table>
<% end %>
